<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Code Dependencies Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { margin: 0; display: flex; }
        #sidebar { 
            width: 300px; 
            height: 100vh; 
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        #file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        #file-tree::-webkit-scrollbar {
            width: 8px;
        }
        #file-tree::-webkit-scrollbar-track {
            background: #f5f5f5;
        }
        #file-tree::-webkit-scrollbar-thumb {
            background: #cdcdcd;
            border-radius: 4px;
        }
        #file-tree::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        #file-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: none;
            background: white;
            color: #333;
        }
        #graph { 
            flex: 1;
            height: 100vh;
            background: white;
        }
        .tree-node {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            white-space: nowrap;
            transition: all 0.1s ease;
            color: #444;
            border: 1px solid transparent;
        }
        .tree-node:hover {
            background: #f0f0f0;
            border: 1px solid #e0e0e0;
        }
        .tree-node.active {
            background: #e8f0fe;
            border: 1px solid #cce0ff;
            color: #1a73e8;
        }
        .tree-node i {
            font-size: 14px;
            width: 16px;
            text-align: center;
        }
        .tree-node i.fa-folder {
            color: #ffd04c;  /* 更鲜艳的文件夹黄色 */
        }
        .tree-node i.fa-folder-open {
            color: #ffba00;  /* 打开状态的文件夹颜色 */
        }
        .tree-node i.fa-file {
            color: #42a5f5;  /* 默认文件图标使用蓝色 */
        }
        .tree-node i.fa-java {
            color: #f89820;  /* Java文件图标使用橙色 */
        }
        .tree-node i.fa-python {
            color: #3776ab;  /* Python文件图标使用蓝色 */
        }
        .tree-node i.fa-js {
            color: #f7df1e;  /* JavaScript文件图标使用黄色 */
        }
        .tree-node i.fa-html5 {
            color: #e34f26;  /* HTML文件图标使用红色 */
        }
        .tree-node i.fa-css3-alt {
            color: #1572b6;  /* CSS文件图标使用蓝色 */
        }
        .tree-node.folder i.fa-folder-open {
            display: none;
        }
        .tree-node.folder.expanded i.fa-folder {
            display: none;
        }
        .tree-node.folder.expanded i.fa-folder-open {
            display: inline;
        }
        .tree-node .node-content {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .tree-children {
            margin-left: 12px;
            display: none;
            border-left: 1px solid #e6e6e6;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-left: 8px;
        }
        .tree-children.expanded {
            display: block;
        }
        pre {
            margin: 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            border: 1px solid #e9ecef;
        }
        .back-button {
            padding: 8px 12px;
            margin: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            color: #495057;
            display: none;
            font-size: 13px;
            transition: all 0.2s ease;
            align-items: center;
            gap: 6px;
        }
        .back-button:hover {
            background: #e9ecef;
            border-color: #ced4da;
            color: #212529;
        }
        .back-button i {
            font-size: 12px;
        }
        .node { cursor: pointer; }
        .node text { 
            font-family: Arial, sans-serif;
            font-size: 12px;
            fill: #333;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        .link { 
            stroke: #999; 
            stroke-opacity: 0.6; 
        }
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 6px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            pointer-events: none;
            max-width: 400px;
            word-wrap: break-word;
            white-space: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            line-height: 1.4;
        }
        .tooltip h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            border-bottom: 1px solid #666;
            padding-bottom: 5px;
        }
        .tooltip .path {
            word-break: break-all;
            margin-bottom: 8px;
        }
        .tooltip .description {
            font-style: italic;
            color: #ccc;
            margin-top: 8px;
        }
        /* 添加节点选中效果 */
        .node circle.selected {
            stroke: #1a73e8;
            stroke-width: 2px;
            filter: drop-shadow(0 0 3px rgba(26, 115, 232, 0.4));
        }
        .node text.selected {
            fill: #1a73e8;
            font-weight: bold;
        }
        /* 添加文件树高亮效果 */
        .tree-node.highlighted {
            background: #e8f0fe;
            border: 1px solid #cce0ff;
            color: #1a73e8;
            font-weight: 500;
        }
        .tree-node.highlighted i {
            color: #1a73e8;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <button class="back-button"><i class="fas fa-arrow-left"></i>返回文件树</button>
        <div id="file-tree"></div>
        <div id="file-content"></div>
    </div>
    <div id="graph"></div>
    <script>
        const data = {"nodes": [{"id": 0, "name": "PayInfoResultBO.java", "full_name": "src/main/java/com/mall4j/cloud/payment/bo/PayInfoResultBO.java", "type": "file", "community_id": 0, "color": "#E41A1C", "degree": 65, "radius": 24.186773244895647, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5b9a\u4e49\u652f\u4ed8\u540e\u8fd4\u56de\u7684\u57fa\u7840\u6570\u636e\u5bf9\u8c61\u3002", "community_description": "\u8be5\u6a21\u5757\u7528\u4e8e\u5904\u7406\u652f\u4ed8\u5f02\u6b65\u56de\u8c03\u901a\u77e5\uff0c\u66f4\u65b0\u652f\u4ed8\u72b6\u6001\u5e76\u901a\u77e5\u8ba2\u5355\u652f\u4ed8\u6210\u529f\u3002"}, {"id": 1, "name": "PayNoticeController.java", "full_name": "src/main/java/com/mall4j/cloud/payment/controller/PayNoticeController.java", "type": "file", "community_id": 0, "color": "#E41A1C", "degree": 20, "radius": 13.416407864998739, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5904\u7406\u652f\u4ed8\u5f02\u6b65\u56de\u8c03\u901a\u77e5\uff0c\u66f4\u65b0\u652f\u4ed8\u72b6\u6001\u5e76\u901a\u77e5\u8ba2\u5355\u652f\u4ed8\u6210\u529f\u3002", "community_description": "\u8be5\u6a21\u5757\u7528\u4e8e\u5904\u7406\u652f\u4ed8\u5f02\u6b65\u56de\u8c03\u901a\u77e5\uff0c\u66f4\u65b0\u652f\u4ed8\u72b6\u6001\u5e76\u901a\u77e5\u8ba2\u5355\u652f\u4ed8\u6210\u529f\u3002"}, {"id": 2, "name": "PayInfoService.java", "full_name": "src/main/java/com/mall4j/cloud/payment/service/PayInfoService.java", "type": "file", "community_id": 2, "color": "#377EB8", "degree": 38, "radius": 18.49324200890693, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5b9a\u4e49\u548c\u7ba1\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u5305\u62ec\u4fdd\u5b58\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u67e5\u8be2\u652f\u4ed8\u4fe1\u606f\u3002", "community_description": "\u8be5\u6a21\u5757\u7528\u4e8e\u5904\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u4fdd\u5b58\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u67e5\u8be2\u64cd\u4f5c\u3002"}, {"id": 3, "name": "PayInfoBO.java", "full_name": "src/main/java/com/mall4j/cloud/payment/bo/PayInfoBO.java", "type": "file", "community_id": 3, "color": "#4DAF4A", "degree": 63, "radius": 23.811761799581316, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5b9a\u4e49\u652f\u4ed8\u4fe1\u606f\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5305\u542b\u652f\u4ed8\u5185\u5bb9\u3001\u91d1\u989d\u3001\u56de\u8c03\u5730\u5740\u7b49\u5173\u952e\u4fe1\u606f\u3002", "community_description": "\u8be5\u6a21\u5757\u8d1f\u8d23\u5904\u7406\u652f\u4ed8\u8bf7\u6c42\u3001\u5b9a\u4e49\u652f\u4ed8\u6570\u636e\u7ed3\u6784\u5e76\u7ba1\u7406\u76f8\u5173\u4e1a\u52a1\u903b\u8f91\u3002"}, {"id": 4, "name": "PayInfo.java", "full_name": "src/main/java/com/mall4j/cloud/payment/model/PayInfo.java", "type": "file", "community_id": 4, "color": "#984EA3", "degree": 44, "radius": 19.8997487421324, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5b9a\u4e49\u548c\u7ba1\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u6570\u636e\u6a21\u578b\u3002", "community_description": "\u8be5\u6a21\u5757\u8d1f\u8d23\u5904\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u652f\u4ed8\u4fe1\u606f\u7684\u4fdd\u5b58\u3001\u72b6\u6001\u66f4\u65b0\u53ca\u652f\u4ed8\u6210\u529f\u540e\u7684\u5904\u7406\u3002"}, {"id": 5, "name": "PayInfoServiceImpl.java", "full_name": "src/main/java/com/mall4j/cloud/payment/service/impl/PayInfoServiceImpl.java", "type": "file", "community_id": 4, "color": "#984EA3", "degree": 64, "radius": 24.0, "description": "\u6b64\u6587\u4ef6\u5b9e\u73b0\u4e86\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u76f8\u5173\u670d\u52a1\uff0c\u5305\u62ec\u652f\u4ed8\u4fe1\u606f\u4fdd\u5b58\u3001\u652f\u4ed8\u72b6\u6001\u66f4\u65b0\u53ca\u652f\u4ed8\u6210\u529f\u540e\u7684\u5904\u7406\u3002", "community_description": "\u8be5\u6a21\u5757\u8d1f\u8d23\u5904\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u652f\u4ed8\u4fe1\u606f\u7684\u4fdd\u5b58\u3001\u72b6\u6001\u66f4\u65b0\u53ca\u652f\u4ed8\u6210\u529f\u540e\u7684\u5904\u7406\u3002"}, {"id": 6, "name": "PayInfoMapper.java", "full_name": "src/main/java/com/mall4j/cloud/payment/mapper/PayInfoMapper.java", "type": "file", "community_id": 2, "color": "#377EB8", "degree": 33, "radius": 17.233687939614086, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5b9a\u4e49\u548c\u7ba1\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u5305\u62ec\u4fdd\u5b58\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u67e5\u8be2\u652f\u4ed8\u4fe1\u606f\u3002", "community_description": "\u8be5\u6a21\u5757\u7528\u4e8e\u5904\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u4fdd\u5b58\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u67e5\u8be2\u64cd\u4f5c\u3002"}, {"id": 7, "name": "PayController.java", "full_name": "src/main/java/com/mall4j/cloud/payment/controller/PayController.java", "type": "file", "community_id": 3, "color": "#4DAF4A", "degree": 28, "radius": 15.874507866387544, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5904\u7406\u652f\u4ed8\u76f8\u5173\u7684\u8bf7\u6c42\u548c\u4e1a\u52a1\u903b\u8f91\u3002", "community_description": "\u8be5\u6a21\u5757\u8d1f\u8d23\u5904\u7406\u652f\u4ed8\u8bf7\u6c42\u3001\u5b9a\u4e49\u652f\u4ed8\u6570\u636e\u7ed3\u6784\u5e76\u7ba1\u7406\u76f8\u5173\u4e1a\u52a1\u903b\u8f91\u3002"}, {"id": 8, "name": "PayInfoDTO.java", "full_name": "src/main/java/com/mall4j/cloud/payment/dto/PayInfoDTO.java", "type": "file", "community_id": 1, "color": "#FF7F00", "degree": 29, "radius": 16.15549442140351, "description": "\u6b64\u6587\u4ef6\u7528\u4e8e\u5b9a\u4e49\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\uff08DTO\uff09\uff0c\u5305\u542b\u8ba2\u5355\u53f7\u548c\u652f\u4ed8\u5b8c\u6210\u540e\u7684\u56de\u8df3\u5730\u5740\u3002", "community_description": "\u5b9a\u4e49\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\uff0c\u5305\u542b\u8ba2\u5355\u53f7\u548c\u652f\u4ed8\u56de\u8df3\u5730\u5740\u3002"}, {"id": 9, "name": "BackType.java", "full_name": "src/main/java/com/mall4j/cloud/payment/constant/BackType.java", "type": "file", "community_id": 4, "color": "#984EA3", "degree": 5, "radius": 8, "description": "\u6b64\u6587\u4ef6\u5b9a\u4e49\u4e86\u652f\u4ed8\u56de\u8c03\u7c7b\u578b\u7684\u679a\u4e3e\u5e38\u91cf\uff0c\u7528\u4e8e\u6807\u8bc6\u652f\u4ed8\u56de\u8c03\u7684\u6765\u6e90\u7c7b\u578b\u3002", "community_description": "\u8be5\u6a21\u5757\u8d1f\u8d23\u5904\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u652f\u4ed8\u4fe1\u606f\u7684\u4fdd\u5b58\u3001\u72b6\u6001\u66f4\u65b0\u53ca\u652f\u4ed8\u6210\u529f\u540e\u7684\u5904\u7406\u3002"}, {"id": 10, "name": "PayStatus.java", "full_name": "src/main/java/com/mall4j/cloud/payment/constant/PayStatus.java", "type": "file", "community_id": 4, "color": "#984EA3", "degree": 5, "radius": 8, "description": "\u6b64\u6587\u4ef6\u5b9a\u4e49\u4e86\u652f\u4ed8\u72b6\u6001\u7684\u679a\u4e3e\u5e38\u91cf\uff0c\u7528\u4e8e\u6807\u8bc6\u652f\u4ed8\u7684\u4e0d\u540c\u72b6\u6001\u3002", "community_description": "\u8be5\u6a21\u5757\u8d1f\u8d23\u5904\u7406\u8ba2\u5355\u652f\u4ed8\u8bb0\u5f55\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u652f\u4ed8\u4fe1\u606f\u7684\u4fdd\u5b58\u3001\u72b6\u6001\u66f4\u65b0\u53ca\u652f\u4ed8\u6210\u529f\u540e\u7684\u5904\u7406\u3002"}], "links": [{"source": 0, "target": 0, "weight": 14.0, "idents": ["setPayAmount", "PayInfoResultBO", "getPayAmount", "getCallbackContent", "setBizPayNo", "getIsPaySuccess", "setCallbackContent", "getSuccessString", "toString", "getPayId", "setSuccessString", "setPayId", "setIsPaySuccess", "getBizPayNo"]}, {"source": 0, "target": 4, "weight": 9.0, "idents": ["setPayAmount", "getCallbackContent", "getPayAmount", "setBizPayNo", "setCallbackContent", "toString", "getPayId", "setPayId", "getBizPayNo"]}, {"source": 0, "target": 3, "weight": 5.0, "idents": ["setPayAmount", "getPayAmount", "toString", "getPayId", "setPayId"]}, {"source": 0, "target": 8, "weight": 1.0, "idents": ["toString"]}, {"source": 1, "target": 0, "weight": 6.0, "idents": ["PayInfoResultBO", "getCallbackContent", "setBizPayNo", "setCallbackContent", "setPayId", "getBizPayNo"]}, {"source": 1, "target": 2, "weight": 2.0, "idents": ["paySuccess", "getByPayId"]}, {"source": 1, "target": 5, "weight": 2.0, "idents": ["paySuccess", "getByPayId"]}, {"source": 1, "target": 6, "weight": 1.0, "idents": ["getByPayId"]}, {"source": 1, "target": 8, "weight": 1.0, "idents": ["getOrderIds"]}, {"source": 1, "target": 4, "weight": 6.0, "idents": ["getCallbackContent", "setBizPayNo", "setCallbackContent", "setPayId", "getOrderIds", "getBizPayNo"]}, {"source": 1, "target": 3, "weight": 1.0, "idents": ["setPayId"]}, {"source": 2, "target": 0, "weight": 1.0, "idents": ["PayInfoResultBO"]}, {"source": 2, "target": 4, "weight": 1.0, "idents": ["PayInfo"]}, {"source": 2, "target": 2, "weight": 6.0, "idents": ["PayInfoService", "pay", "isPay", "paySuccess", "getByPayId", "getPayStatusByOrderIds"]}, {"source": 2, "target": 7, "weight": 2.0, "idents": ["isPay", "pay"]}, {"source": 2, "target": 5, "weight": 5.0, "idents": ["pay", "isPay", "paySuccess", "getByPayId", "getPayStatusByOrderIds"]}, {"source": 2, "target": 6, "weight": 3.0, "idents": ["isPay", "getPayStatusByOrderIds", "getByPayId"]}, {"source": 2, "target": 8, "weight": 1.0, "idents": ["PayInfoDTO"]}, {"source": 2, "target": 3, "weight": 1.0, "idents": ["PayInfoBO"]}, {"source": 3, "target": 4, "weight": 5.0, "idents": ["setPayAmount", "getPayAmount", "toString", "getPayId", "setPayId"]}, {"source": 3, "target": 0, "weight": 5.0, "idents": ["setPayAmount", "getPayAmount", "toString", "getPayId", "setPayId"]}, {"source": 3, "target": 3, "weight": 14.0, "idents": ["setPayAmount", "getPayAmount", "getBody", "getBizUserId", "setReturnUrl", "PayInfoBO", "toString", "setBody", "getPayId", "setApiNoticeUrl", "setPayId", "getReturnUrl", "getApiNoticeUrl", "setBizUserId"]}, {"source": 3, "target": 8, "weight": 3.0, "idents": ["setReturnUrl", "getReturnUrl", "toString"]}, {"source": 5, "target": 4, "weight": 19.388905057061258, "idents": ["setSysType", "setPayAmount", "setOrderIds", "getPayAmount", "getCallbackContent", "PayInfo", "getSysType", "setUserId", "setBizPayNo", "setVersion", "setCallbackContent", "setPayStatus", "getPayId", "setPayId", "getOrderIds", "setCallbackTime", "getBizPayNo"]}, {"source": 5, "target": 0, "weight": 8.694488242957934, "idents": ["setPayAmount", "getCallbackContent", "getPayAmount", "setBizPayNo", "setCallbackContent", "getPayId", "setPayId", "getBizPayNo"]}, {"source": 5, "target": 3, "weight": 6.328218155770393, "idents": ["setPayAmount", "getPayAmount", "PayInfoBO", "setBody", "getPayId", "setPayId"]}, {"source": 5, "target": 2, "weight": 4.0, "idents": ["isPay", "getPayStatusByOrderIds", "getByPayId", "PayInfoService"]}, {"source": 5, "target": 7, "weight": 1.0, "idents": ["isPay"]}, {"source": 5, "target": 5, "weight": 3.0, "idents": ["isPay", "getPayStatusByOrderIds", "getByPayId"]}, {"source": 5, "target": 6, "weight": 5.0, "idents": ["isPay", "save", "getByPayId", "getPayStatusByOrderIds", "update"]}, {"source": 5, "target": 8, "weight": 2.0, "idents": ["setOrderIds", "getOrderIds"]}, {"source": 5, "target": 10, "weight": 1.4142135623730951, "idents": ["value"]}, {"source": 5, "target": 9, "weight": 1.189207115002721, "idents": ["value"]}, {"source": 6, "target": 4, "weight": 1.7320508075688772, "idents": ["PayInfo"]}, {"source": 6, "target": 6, "weight": 7.0, "idents": ["PayInfoMapper", "isPay", "save", "getPayStatusByOrderIds", "getByPayId", "deleteById", "update"]}, {"source": 6, "target": 2, "weight": 3.0, "idents": ["isPay", "getPayStatusByOrderIds", "getByPayId"]}, {"source": 6, "target": 7, "weight": 1.0, "idents": ["isPay"]}, {"source": 6, "target": 5, "weight": 3.0, "idents": ["isPay", "getPayStatusByOrderIds", "getByPayId"]}, {"source": 7, "target": 2, "weight": 3.0, "idents": ["isPay", "getPayStatusByOrderIds", "pay"]}, {"source": 7, "target": 7, "weight": 2.0, "idents": ["isPay", "pay"]}, {"source": 7, "target": 5, "weight": 3.0, "idents": ["isPay", "getPayStatusByOrderIds", "pay"]}, {"source": 7, "target": 6, "weight": 2.0, "idents": ["isPay", "getPayStatusByOrderIds"]}, {"source": 7, "target": 3, "weight": 6.090507732665258, "idents": ["getBizUserId", "setReturnUrl", "getPayId", "setApiNoticeUrl", "getReturnUrl", "setBizUserId"]}, {"source": 7, "target": 8, "weight": 2.0, "idents": ["setReturnUrl", "getReturnUrl"]}, {"source": 7, "target": 4, "weight": 2.8284271247461903, "idents": ["getUserId", "getPayId"]}, {"source": 7, "target": 0, "weight": 1.189207115002721, "idents": ["getPayId"]}, {"source": 7, "target": 1, "weight": 1.0, "idents": ["submit"]}, {"source": 8, "target": 8, "weight": 6.0, "idents": ["PayInfoDTO", "setOrderIds", "setReturnUrl", "toString", "getOrderIds", "getReturnUrl"]}, {"source": 8, "target": 4, "weight": 3.0, "idents": ["setOrderIds", "getOrderIds", "toString"]}, {"source": 8, "target": 0, "weight": 1.0, "idents": ["toString"]}, {"source": 8, "target": 3, "weight": 3.0, "idents": ["setReturnUrl", "getReturnUrl", "toString"]}, {"source": 9, "target": 10, "weight": 1.0, "idents": ["value"]}, {"source": 9, "target": 9, "weight": 1.0, "idents": ["value"]}, {"source": 10, "target": 10, "weight": 1.0, "idents": ["value"]}, {"source": 10, "target": 9, "weight": 1.0, "idents": ["value"]}]};
        
        // 创建文件树数据结构
        function createFileTree(files) {
            const root = { name: '', children: {} };
            files.forEach(file => {
                const parts = file.full_name.split('/');
                let current = root;
                parts.forEach((part, i) => {
                    if (!current.children[part]) {
                        current.children[part] = { 
                            name: part,
                            path: parts.slice(0, i + 1).join('/'),
                            children: {},
                            isFile: i === parts.length - 1,
                            description: i === parts.length - 1 ? file.description : ''
                        };
                    }
                    current = current.children[part];
                });
            });
            return root;
        }

        // 渲染文件树
        function renderFileTree(node, container, level = 0) {
            const items = Object.values(node.children).sort((a, b) => {
                if (a.isFile === b.isFile) return a.name.localeCompare(b.name);
                return a.isFile ? 1 : -1;
            });

            items.forEach(item => {
                const nodeDiv = document.createElement('div');
                nodeDiv.className = 'tree-node' + (item.isFile ? '' : ' folder');
                
                // 添加图标
                const icon = document.createElement('i');
                if (item.isFile) {
                    icon.className = 'fas fa-file';
                    // 根据文件扩展名设置不同的图标
                    const ext = item.name.split('.').pop().toLowerCase();
                    switch(ext) {
                        case 'java':
                            icon.className = 'fab fa-java';
                            break;
                        case 'py':
                            icon.className = 'fab fa-python';
                            break;
                        case 'js':
                            icon.className = 'fab fa-js';
                            break;
                        case 'html':
                            icon.className = 'fab fa-html5';
                            break;
                        case 'css':
                            icon.className = 'fab fa-css3-alt';
                            break;
                    }
                } else {
                    nodeDiv.innerHTML = `
                        <i class="fas fa-folder"></i>
                        <i class="fas fa-folder-open"></i>
                    `;
                }
                if (item.isFile) {
                    nodeDiv.appendChild(icon);
                }
                
                // 添加文件名
                const content = document.createElement('span');
                content.className = 'node-content';
                content.textContent = item.name;
                nodeDiv.appendChild(content);
                
                container.appendChild(nodeDiv);
                
                if (!item.isFile) {
                    const childrenDiv = document.createElement('div');
                    childrenDiv.className = 'tree-children';
                    container.appendChild(childrenDiv);
                    
                    // 添加文件夹点击展开/折叠事件
                    nodeDiv.onclick = (e) => {
                        e.stopPropagation();
                        nodeDiv.classList.toggle('expanded');
                        childrenDiv.classList.toggle('expanded');
                    };
                    
                    renderFileTree(item, childrenDiv, level + 1);
                } else {
                    // 修改文件节点的点击事件
                    nodeDiv.onclick = (e) => {
                        e.stopPropagation();
                        // 清除所有文件节点的高亮
                        document.querySelectorAll('.tree-node').forEach(node => {
                            node.classList.remove('highlighted');
                        });
                        // 添加当前节点的高亮
                        nodeDiv.classList.add('highlighted');
                        
                        // 高亮对应的d3节点
                        const fullPath = item.path;
                        highlightD3Node(fullPath);
                        
                        // 显示文件内容
                        showFileContent(fullPath);
                    };
                }
            });
        }

        // 添加高亮d3节点的函数
        function highlightD3Node(fullPath) {
            // 清除所有节点的选中状态
            node.selectAll("circle").classed("selected", false);
            node.selectAll("text").classed("selected", false);
            
            // 找到并高亮对应的节点
            node.each(function(d) {
                if (d.full_name === fullPath) {
                    const selectedNode = d3.select(this);
                    selectedNode.select("circle").classed("selected", true);
                    selectedNode.select("text").classed("selected", true);
                    
                    // 将节点移动到视图中心
                    const transform = d3.zoomTransform(svg.node());
                    const scale = transform.k;
                    const x = -d.x * scale + width / 2;
                    const y = -d.y * scale + height / 2;
                    
                    svg.transition()
                        .duration(750)
                        .call(
                            zoom.transform,
                            d3.zoomIdentity
                                .translate(x, y)
                                .scale(scale)
                        );
                }
            });
        }

        // 显示文件内容
        async function showFileContent(path) {
            const fileTree = document.getElementById('file-tree');
            const fileContent = document.getElementById('file-content');
            const backButton = document.querySelector('.back-button');
            
            try {
                const response = await fetch(path);
                const content = await response.text();
                
                const pre = document.createElement('pre');
                pre.textContent = content;
                
                fileContent.innerHTML = '';
                fileContent.appendChild(pre);
                
                fileTree.style.display = 'none';
                fileContent.style.display = 'block';
                backButton.style.display = 'flex';
                
                // 高亮当前文件在文件树中的节点
                document.querySelectorAll('.tree-node').forEach(node => {
                    node.classList.remove('active');
                    if (node.querySelector('.node-content').textContent === path.split('/').pop()) {
                        node.classList.add('active');
                    }
                });
            } catch (error) {
                console.error('Error loading file:', error);
                fileContent.innerHTML = `
                    <div style="padding: 16px; color: #f44336;">
                        <i class="fas fa-exclamation-circle"></i>
                        Error loading file: ${path}
                    </div>
                `;
            }
        }

        // 返回文件树视图
        document.querySelector('.back-button').onclick = () => {
            document.getElementById('file-tree').style.display = 'block';
            document.getElementById('file-content').style.display = 'none';
            document.querySelector('.back-button').style.display = 'none';
        };

        // 初始化文件树
        const fileTree = createFileTree(data.nodes);
        renderFileTree(fileTree, document.getElementById('file-tree'));

        /* 创建SVG */
        const width = document.getElementById('graph').offsetWidth;
        const height = window.innerHeight;
        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
            
        /* 创建缩放和平移行为 */
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                container.attr("transform", event.transform);
            });
            
        svg.call(zoom);
        
        const container = svg.append("g");
        
        /* 创建力导向图布局 */
        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links)
                .id(d => d.id)
                .distance(d => {
                    const nodeCount = data.nodes.length;
                    const linkCount = data.links.length;
                    const baseDist = 50;
                    const nodeRatio = nodeCount / 100;  // 每100个节点增加一倍基础距离
                    const linkRatio = linkCount / 500;  // 每500条边增加一倍基础距离
                    return baseDist * (1 + nodeRatio) * (1 + linkRatio);
                })
                .strength(0.2))  /* 减小link force的strength */
            .force("charge", d3.forceManyBody()
                .strength(d => {
                    const nodeCount = data.nodes.length;
                    const baseCharge = -100;
                    const chargeRatio = nodeCount / 100;  // 每100个节点增加一倍斥力
                    return baseCharge * (1 + chargeRatio);
                }))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("x", d3.forceX(width / 2).strength(0.05))
            .force("y", d3.forceY(height / 2).strength(0.05))
            .force("collide", d3.forceCollide()
                .radius(d => d.radius * 2.5)  /* 增加碰撞半径 */
                .strength(1)
                .iterations(3))
            .alphaDecay(0.01)  /* 减缓alpha衰减速度 */
            .velocityDecay(0.5);  /* 减缓速度衰减 */
            
        /* 绘制连接线 */
        const link = container.append("g")
            .selectAll("line")
            .data(data.links)
            .join("line")
            .attr("class", "link")
            .attr("stroke-width", d => Math.sqrt(d.weight));
            
        /* 创建节点组 */
        const node = container.append("g")
            .selectAll(".node")
            .data(data.nodes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        /* 添加节点圆圈 */
        node.append("circle")
            .attr("r", d => d.radius)
            .attr("fill", d => d.color)
            .attr("stroke", "#fff")
            .attr("stroke-width", 1.5);

        /* 添加节点标签 */
        node.append("text")
            .text(d => d.name)
            .attr("x", 0)
            .attr("y", d => -d.radius - 5);

        /* 添加提示框 */
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // 在文件树中定位到指定文件
        function locateFile(fullPath) {
            const parts = fullPath.split('/');
            let currentNode = null;
            let currentPath = '';
            
            // 清除所有高亮
            document.querySelectorAll('.tree-node').forEach(node => {
                node.classList.remove('highlighted');
            });
            
            // 展开所有父文件夹
            for (let i = 0; i < parts.length; i++) {
                currentPath += (i === 0 ? '' : '/') + parts[i];
                const treeNodes = document.querySelectorAll('.tree-node');
                
                for (const node of treeNodes) {
                    const content = node.querySelector('.node-content');
                    if (content && content.textContent === parts[i]) {
                        currentNode = node;
                        // 如果是文件夹且未展开，则展开它
                        if (i < parts.length - 1 && !node.classList.contains('expanded')) {
                            node.click();
                        }
                        // 如果是目标文件，添加高亮效果
                        if (i === parts.length - 1) {
                            node.classList.add('highlighted');
                        }
                        break;
                    }
                }
            }
            
            // 如果找到了目标文件节点
            if (currentNode) {
                // 滚动到该节点
                currentNode.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // 触发点击事件以显示文件内容
                if (currentNode.classList.contains('highlighted')) {
                    showFileContent(fullPath);
                }
            }
        }

        /* 节点交互 */
        node.on("click", (event, d) => {
                event.stopPropagation(); // 阻止事件冒泡
                
                // 清除之前的选中状态
                node.selectAll("circle").classed("selected", false);
                node.selectAll("text").classed("selected", false);
                
                // 添加新的选中状态
                const clickedNode = d3.select(event.currentTarget);
                clickedNode.select("circle").classed("selected", true);
                clickedNode.select("text").classed("selected", true);
                
                locateFile(d.full_name);
            })
            .on("mouseover", (event, d) => {
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                    
                let tooltipContent = `<h4>${d.name}</h4>`;
                tooltipContent += `<div class="path"><strong>Full path:</strong><br>${d.full_name}</div>`;
                tooltipContent += `<strong>Degree:</strong> ${d.degree}<br>`;
                
                if (d.community_id !== null) {
                    tooltipContent += `<div class="description"><strong>Community:</strong><br>${d.community_description}</div>`;
                }
                
                if (d.description) {
                    tooltipContent += `<div class="description"><strong>File:</strong><br>${d.description}</div>`;
                }
                
                tooltip.html(tooltipContent)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", () => {
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        /* 模拟tick事件 */
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        /* 拖拽函数 */
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        // 处理窗口大小变化
        window.addEventListener('resize', () => {
            const newWidth = document.getElementById('graph').offsetWidth;
            svg.attr("width", newWidth);
            simulation.force("center", d3.forceCenter(newWidth / 2, height / 2))
                .alpha(0.3)
                .restart();
        });
    </script>
</body>
</html>